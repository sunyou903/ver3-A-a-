<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>두 파일 매칭 · MatchFlag</title>
  <meta name="color-scheme" content="light dark">
  <style>
    :root { --bg:#0b0c10; --panel:#101219; --card:#141820; --text:#e7eaf1; --muted:#9aa3b2; --border:#242a35; --brand:#6e6cff; --accent:#79ffe1; --radius:16px; --shadow:0 8px 24px rgba(0,0,0,.25); }
    :root.light { --bg:#f7f8fb; --panel:#ffffff; --card:#ffffff; --text:#0f172a; --muted:#6b7280; --border:#e7eaf1; --brand:#4f46e5; --accent:#10b981; --shadow:0 12px 30px rgba(20,24,40,.06); }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:
        radial-gradient(1100px 600px at 110% -10%, color-mix(in srgb,var(--brand) 12%, transparent), transparent 60%),
        radial-gradient(1200px 800px at -10% 120%, color-mix(in srgb,var(--accent) 10%, transparent), transparent 60%),
        var(--bg);
      color:var(--text);
      font-family:ui-sans-serif,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic",sans-serif;
      line-height:1.6
    }
    .container{max-width:1100px;margin:0 auto;padding:24px}
    .nav{position:sticky;top:0;z-index:40;backdrop-filter:saturate(180%) blur(10px);background:color-mix(in srgb,var(--panel) 70%, transparent);border-bottom:1px solid var(--border)}
    .nav-inner{display:flex;align-items:center;justify-content:space-between;padding:12px 24px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .logo{width:28px;height:28px;border-radius:9px;background:linear-gradient(135deg,var(--brand),var(--accent));box-shadow:var(--shadow)}
    .toggle{width:48px;height:28px;border-radius:999px;border:1px solid var(--border);background:var(--panel);position:relative;cursor:pointer}
    .dot{position:absolute;top:3px;left:3px;width:22px;height:22px;border-radius:999px;background:linear-gradient(135deg,var(--brand),var(--accent));transition:transform .2s ease}
    .toggle.active .dot{transform:translateX(20px)}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{grid-column:span 12;background:linear-gradient(180deg,color-mix(in srgb,var(--panel) 96%, transparent),var(--card));border:1px solid var(--border);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow)}
    @media(min-width:840px){.half{grid-column:span 6}}
    h1{font-size:clamp(22px,3vw,32px);margin:12px 0 6px}
    .muted{color:var(--muted)}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){.row-2{grid-template-columns:repeat(2,1fr)}}
    label{font-size:13px;color:var(--muted)}
    .input, .file {width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:var(--panel);color:var(--text)}
    .file{padding:10px 12px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 16px;border-radius:12px;border:1px solid color-mix(in srgb,var(--brand) 40%, var(--border));background:linear-gradient(180deg,color-mix(in srgb,var(--brand) 12%, var(--card)),var(--card));color:var(--text);font-weight:700;cursor:pointer;transition:transform .08s ease,border-color .2s ease}
    .btn:hover{transform:translateY(-1px);border-color:var(--brand)}
    .btn.ghost{background:var(--panel);border-color:var(--border);font-weight:600}
    /* Log */
    .log{height:200px;overflow:auto;border:1px dashed color-mix(in srgb,var(--muted) 40%, var(--border));border-radius:12px;background:var(--panel);padding:12px;font-family:ui-monospace, SFMono-Regular, Menlo, monospace;font-size:12px;white-space:pre-wrap}
    .progress{height:10px;border-radius:999px;background:color-mix(in srgb,var(--border) 60%, transparent);overflow:hidden}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--brand),var(--accent));transition:width .3s ease}
    .hint{font-size:12px;color:var(--muted)}
  
    /* Drag & Drop */
    .dropzone{display:flex;align-items:center;justify-content:center;gap:8px;
      padding:18px;border:2px dashed var(--border);border-radius:12px;background:color-mix(in srgb, var(--panel) 92%, transparent);
      color:var(--muted); cursor:pointer; transition:border-color .2s ease, background .2s ease}
    .dropzone:hover{border-color:var(--brand)}
    .dropzone.dragover{border-color:var(--accent); background:color-mix(in srgb, var(--accent) 6%, var(--panel))}
    .dropzone .name{color:var(--text); font-weight:600}
    input.file{display:none}
    
</style>
</head>
<body>
  <header class="nav">
    <div class="nav-inner container">
      <div class="brand"><div class="logo" aria-hidden="true"></div>MatchFlag</div>
      <nav style="display:flex;gap:10px;">
        <a href="index.html" class="btn ghost" style="padding:6px 10px;font-size:14px;">두 파일 매칭</a>
        <a href="matchflag.html" class="btn ghost" style="padding:6px 10px;font-size:14px;">다시트 검증</a>
      </nav>

      <button id="themeBtn" class="toggle" aria-label="테마 전환"><span class="dot"></span></button>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h1>두 파일 매칭</h1>
      <p class="muted">엑셀 A/B의 <strong>단가대비표</strong> 시트를 기준으로 항목을 매칭하고, 가격 항목을 비교합니다. (브라우저 내 처리)</p>

      <div class="grid" style="margin-top:12px;">
        <div class="card half">
          <div class="row">
            <div>
              <label for="fileA">파일 A</label>
<div id="dropA" class="dropzone" role="button" aria-label="파일 A 드래그&드롭 또는 클릭하여 선택"><span class="hint">여기로 파일을 드래그하거나 클릭해서 선택</span> <span id="nameA" class="name"></span></div>
<input id="fileA" class="file" type="file" accept=".xlsx,.xls,.xlsm,.xlsb" />
            </div>
            <div>
              <label for="sheetA">시트명 (기본: 단가대비표)</label>
              <input id="sheetA" class="input" placeholder="단가대비표" />
            </div>
          </div>
        </div>
        <div class="card half">
          <div class="row">
            <div>
              <label for="fileB">파일 B</label>
<div id="dropB" class="dropzone" role="button" aria-label="파일 B 드래그&드롭 또는 클릭하여 선택"><span class="hint">여기로 파일을 드래그하거나 클릭해서 선택</span> <span id="nameB" class="name"></span></div>
<input id="fileB" class="file" type="file" accept=".xlsx,.xls,.xlsm,.xlsb" />
            </div>
            <div>
              <label for="sheetB">시트명 (기본: 단가대비표)</label>
              <input id="sheetB" class="input" placeholder="단가대비표" />
            </div>
          </div>
        </div>
      </div>

      <div class="row row-2" style="margin-top:12px;align-items:end;">
        <div>
          <label for="threshold">유사도 임계값 (%)</label>
          <input id="threshold" class="input" type="number" min="0" max="100" step="1" value="30" />
          <div class="hint">낮을수록 느슨하게 매칭합니다. 데이터 품질이 낮으면 40–60% 권장.</div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end">
          <button id="run" class="btn" aria-label="매칭 실행">매칭 실행</button>
          <button id="clear" class="btn ghost" aria-label="입력 초기화">초기화</button>
        </div>
      </div>

      <div class="progress" style="margin:16px 0 8px;"><div id="bar" class="bar"></div></div>
      <div id="log" class="log" aria-live="polite">대기 중…</div>
    </section>
  </main>

  <script>
    // Theme
    const root = document.documentElement; const btn = document.getElementById('themeBtn');
    const setTheme = (m)=>{ if(m==='light') root.classList.add('light'); else root.classList.remove('light'); localStorage.setItem('mf-theme', m); btn.classList.toggle('active', m==='light'); };
    setTheme(localStorage.getItem('mf-theme') || (matchMedia('(prefers-color-scheme: light)').matches?'light':'dark'));
    btn.addEventListener('click',()=> setTheme(root.classList.contains('light')?'dark':'light'));

    // UX helpers
    const log = document.getElementById('log'); const bar = document.getElementById('bar');
    document.getElementById('clear').addEventListener('click',()=>{ ['fileA','fileB','sheetA','sheetB'].forEach(id=>{const el=document.getElementById(id); if(el && el.type==='file') el.value=''; else if(el) el.value='';}); log.textContent='초기화됨'; bar.style.width='0%'; });
    document.getElementById('run').addEventListener('click',()=>{ if(typeof window.run==='function'){ try{ window.run(); }catch(e){ log.textContent = '실행 중 오류: '+e.message; } } else { log.textContent='(참고) nb2.js가 로딩되면 여기서 자동으로 실행을 위임합니다.'; } });
  </script>
  
  <script>
  // Drag & Drop helpers for index.html
  function bindDropzone(zoneId, inputId, nameId){
    const zone = document.getElementById(zoneId);
    const input = document.getElementById(inputId);
    const nameEl = document.getElementById(nameId);
    if(!zone || !input) return;
    const accept = (input.getAttribute('accept')||'').split(',').map(s=>s.trim().toLowerCase()).filter(Boolean);

    function setFile(file){
      const ok = accept.length===0 || accept.some(ext => file.name.toLowerCase().endsWith(ext));
      if(!ok){ alert('지원하지 않는 파일 형식입니다: ' + file.name); return; }
      const dt = new DataTransfer();
      dt.items.add(file);
      input.files = dt.files;
      if(nameEl){ nameEl.textContent = file.name; }
      const lg = document.getElementById('log');
      if(lg){ lg.textContent = (lg.textContent||'') + '\n선택됨: ' + file.name; }
    }

    zone.addEventListener('click', () => input.click());
    input.addEventListener('change', () => { if(input.files && input.files[0]) setFile(input.files[0]); });
    ['dragenter','dragover'].forEach(ev => zone.addEventListener(ev, (e)=>{ e.preventDefault(); e.stopPropagation(); zone.classList.add('dragover'); }));
    ['dragleave','drop'].forEach(ev => zone.addEventListener(ev, (e)=>{ e.preventDefault(); e.stopPropagation(); zone.classList.remove('dragover'); }));
    zone.addEventListener('drop', (e)=>{
      const files = e.dataTransfer && e.dataTransfer.files;
      if(files && files.length){ setFile(files[0]); }
    });
  }
  bindDropzone('dropA','fileA','nameA');
  bindDropzone('dropB','fileB','nameB');
  </script>
    
<script src="lib/xlsx.full.min.js"></script>
  <script src="nb2.js"></script>
</body>
</html>
